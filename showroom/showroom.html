<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dịch vụ - Nguyễn An</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../styles.css">
  </head>

  <body class="bg-gray-100 font-['Roboto'] min-h-screen flex flex-col">

  <!-- Navbar -->
  <nav class="container mx-auto flex items-center justify-end py-4 md:py-6 relative overflow-hidden rounded-xl">
    <div class="flex flex-col items-center border-4 border-orange-500 px-2 py-2 mr-6 bg-transparent cursor-pointer shadow-lg rounded-xl relative z-10"
         style="backdrop-filter:none;width:120px;height:120px;padding:0;display:flex;align-items:center;justify-content:center;"
         onclick="window.location.href='../index.html'">
      <img src="../logo/logo.png" alt="Nguyen An Logo"
           style="width:112px;height:112px;object-fit:contain;display:block;margin:0;padding:0;">
    </div>
    <div class="flex-1 flex items-center justify-end relative z-10">
      <div class="flex bg-transparent border-4 border-orange-500 text-base md:text-lg relative shadow-lg rounded-xl overflow-hidden"
           style="position:relative;">
        <div class="absolute inset-0 w-full h-full pointer-events-none z-0">
          <img src="../chuvan/chuvanden.png" alt="Hoa văn navbar" class="w-full h-full object-cover opacity-25"
               style="mix-blend-mode:multiply;"/>
        </div>
        <a href="../index.html" class="menu-link px-7 py-4 text-orange-500 font-semibold hover:underline">Về Trang Chủ</a>
        <a href="../introduce/introduce.html" class="menu-link px-7 py-4 text-orange-500 font-semibold hover:underline relative z-10">Giới thiệu</a>
        <a href="../project/project.html" class="menu-link px-7 py-4 text-orange-500 font-semibold hover:underline relative z-10">Dự án</a>
        <a href="../showroom/showroom.html" class="menu-link px-7 py-4 text-orange-500 font-semibold hover:underline relative z-10">Showroom</a>
        <a href="../recruitment/recruitment.html" class="menu-link px-7 py-4 text-orange-500 font-semibold hover:underline relative z-10">Tuyển dụng</a>
        <a href="../contact/contact.html" class="ml-4 bg-orange-500 hover:bg-orange-600 text-white font-bold px-7 py-4 relative z-10">Liên Hệ</a>
      </div>
    </div>
  </nav>

  <h2 class="text-4xl md:text-5xl font-bold text-orange-500 mb-8 text-center drop-shadow-lg uppercase tracking-widest w-full">Showroom 3D</h2>
            <!-- 3D Model Viewer Section -->
        <div class="w-full flex flex-col md:flex-row items-center justify-center py-16 md:pl-30">
            <!-- Cột thumbnail 3D nhỏ -->
          <div class="flex flex-col items-center md:items-start md:w-32 w-full mb-8 md:mb-0 md:mr-4 bg-white/80 rounded-2xl shadow-lg p-4 border border-orange-200"
              style="height: 700px; min-height: 350px; box-sizing: border-box;">
        <div class="flex flex-row md:flex-col gap-4 w-full md:w-auto h-full">
      
          <!-- New uploaded models -->
          <button class="thumbnail-3d border-2 border-gray-300 rounded-xl overflow-hidden focus:ring-2 ring-orange-500 transition" data-model="Bai_vi.glb" data-title="Bài vị" data-material="Gỗ Phủ Sơn" data-origin="Thế Kỉ 18" data-desc="Bài vị truyền thống, phục dựng chi tiết văn tự và hoa văn." >
            <img src="../3d picture/Bai_vi.jpg" alt="Bài vị" class="w-20 h-20 object-cover" />
          </button>
          <button class="thumbnail-3d border-2 border-gray-300 rounded-xl overflow-hidden focus:ring-2 ring-orange-500 transition" data-model="Ghe_tho.glb" data-title="Ngai thờ" data-material="Gỗ Phủ Sơn" data-origin=" Thời Lê Trung Hưng-Thế Kỉ 18" data-desc="Ghế thờ chạm khắc tinh xảo, mô phỏng kiểu truyền thống." >
            <img src="../3d picture/Ghe_tho.jpg" alt="Ghế thờ" class="w-20 h-20 object-cover" />
          </button>
          <button class="thumbnail-3d border-2 border-gray-300 rounded-xl overflow-hidden focus:ring-2 ring-orange-500 transition" data-model="Nghe_thoi_Le.glb" data-title="Nghê thời Lê" data-material="Gỗ Phủ Sơn" data-origin="Thời Lê Trung Hưng-Thế Kỉ 18" data-desc="Tượng nghê thời Lê, phục dựng chi tiết nghệ thuật điêu khắc." >
            <img src="../3d picture/Nghe_thoi_Le.jpg" alt="Nghê thời Lê" class="w-20 h-20 object-cover" />
          </button>
          <button class="thumbnail-3d border-2 border-gray-300 rounded-xl overflow-hidden focus:ring-2 ring-orange-500 transition" data-model="Tuong.glb" data-title="Tượng Văn Thù Bồ Tát" data-material="Đất Phủ Sơn" data-origin="Thế Kỉ 19" data-desc="Tượng phong cách cổ, phục dựng chi tiết." >
            <img src="../3d picture/Tuong.jpg" alt="Tượng" class="w-20 h-20 object-cover" />
          </button>
          <button class="thumbnail-3d border-2 border-gray-300 rounded-xl overflow-hidden focus:ring-2 ring-orange-500 transition" data-model="Van_gio.glb" data-title="Mảng Chạm Ván Gió Tiền Mái" data-material="Gỗ Lim" data-origin="Thời Lê Trung Hưng-Thế Kỉ 17" data-desc="Hoa văn vân gió truyền thống." >
            <img src="../3d picture/Van_gio.jpg" alt="Vân gió" class="w-20 h-20 object-cover" />
          </button>
        </div>
            </div>
            <!-- Cột giới thiệu -->
            <div id="info-col" class="flex flex-col justify-start items-start w-full md:w-64 max-w-full mb-8 md:mb-0 md:mr-4 bg-white/80 rounded-2xl shadow-lg p-4 border border-orange-200"
                     style="height: 700px; min-height: 350px; box-sizing: border-box;">
                <h2 class="text-2xl font-bold text-orange-600 mb-4" id="model-title">Giới thiệu mô hình 3D</h2>
                <p class="text-base text-gray-800 mb-2"><span class="font-semibold">Tên mô hình:</span> <span id="model-name">Bài Vị </span></p>
                <p class="text-base text-gray-800 mb-2"><span class="font-semibold">Chất liệu:</span> <span id="model-material">Gỗ Phủ Sơn</span></p>
                <p class="text-base text-gray-800 mb-2"><span class="font-semibold">Nguồn gốc:</span> <span id="model-origin">Thế Kỉ 18</span></p>
    
                <div class="flex-1"></div>
            </div>
            <!-- Model viewer lớn -->
            <div class="flex-shrink-0 flex items-center justify-center mx-auto md:ml-0 md:mr-0 relative" id="viewer-wrapper">
                <!-- loader overlay (mặc định ẩn) -->
                <div id="viewer-loader" class="absolute inset-0 bg-black/60 backdrop-blur-sm flex flex-col items-center justify-center rounded-xl z-40 hidden">
                    <svg class="animate-spin h-12 w-12 text-white mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                    </svg>
                    <div class="text-white text-lg font-semibold">Loading…</div>
                </div>

                <iframe
                  id="secure-viewer"
                  src="/viewer.html?auto=1&compact=1&model=Bai_vi.glb"
                  style="width: 900px; max-width: 95vw; height: 700px; background: radial-gradient(circle at 50% 40%, #6b4f2a 0%, #3e2c18 80%, #1a1208 100%); border-radius: 1rem; box-shadow: 0 4px 24px rgba(0,0,0,0.28); border:0; display:block;"
                  allow="xr-spatial-tracking; fullscreen; autoplay">
                </iframe>
            </div>
        </div>


  <!-- Footer -->
  <footer class="bg-[#fafafa] pt-16 pb-6 mt-0 mt-auto"
          style="background-image:url('../chuvan/chuvantrang.png');background-size:cover;background-repeat:no-repeat;background-position:center;">
    <div class="container mx-auto px-4">
      <hr class="border-t border-gray-400 mb-10">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-8 items-start">
        <div class="md:col-span-1 flex flex-col items-start mb-8 md:mb-0">
          <span class="text-3xl font-extrabold mb-1">Nguyễn An</span>
          <span class="text-base text-gray-700">NguyenAn.,JSC</span>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-2">Trụ sở chính</h3>
          <p>195 Phố Bồ Đề, Phường Bồ Đề,<br/>Quận Long Biên – TP Hà Nội</p>
          <p>nguyenanvanhoa@gmail.com</p>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-2">Mạng xã hội</h3>
          <p><a href="https://www.facebook.com/nguyenan.org" class="hover:underline">Facebook</a></p>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-2">Liên hệ</h3>
          <p>Nếu có bất kỳ thắc mắc, câu hỏi hoặc nhận xét, vui lòng gọi: 024 6659 9222</p>
        </div>
        <div class="flex flex-col items-center md:items-end w-full">
          <a href="../contact/contact.html"
             class="bg-orange-500 hover:bg-orange-600 text-black font-semibold px-12 py-4 text-lg mt-6 md:mt-0"
             style="min-width:200px;text-align:center;">Liên hệ Nguyễn An</a>
        </div>
      </div>
      <div class="flex flex-col md:flex-row justify-between items-center mt-12 text-sm text-gray-700">
        <div>
          Chính sách Quyền riêng tư<br/>
          © 2035 bản quyền của Nguyễn An.
        </div>
        <a href="../index.html" class="mt-4 md:mt-0 underline hover:text-orange-500">Về đầu trang</a>
      </div>
    </div>
  </footer>

  <!-- JS: xử lý thumbnail + đổi model trong iframe viewer mã hoá -->
  <script>
    (function(){
      const iframe = document.getElementById('secure-viewer');
      const loader = document.getElementById('viewer-loader');
      const SRC_BASE = '/viewer.html'; // nhúng trực tiếp viewer qua reverse proxy
      let hideFallbackTimer = null;

      function showLoader(){
        if(hideFallbackTimer){ clearTimeout(hideFallbackTimer); hideFallbackTimer = null; }
        loader.classList.remove('hidden');
        // fallback: tự ẩn sau 25s phòng trường hợp iframe không gửi message
        hideFallbackTimer = setTimeout(()=> { hideLoader(); }, 25000);
      }
      function hideLoader(){
        if(hideFallbackTimer){ clearTimeout(hideFallbackTimer); hideFallbackTimer = null; }
        loader.classList.add('hidden');
      }

      function setModelInIframe(modelName){
        // show loader ngay khi bắt đầu đổi model (chờ decrypt)
        showLoader();

        const url = new URL(SRC_BASE, window.location.origin);
        url.searchParams.set('auto','1');
        url.searchParams.set('compact','1'); // keep header hidden when switching models
        url.searchParams.set('model', modelName);
        // set src and also ensure the child viewer receives a hideHeader message after it loads
        iframe.onload = () => {
          try{ iframe.contentWindow.postMessage('hideHeader', window.location.origin); }catch(e){}
        };
        iframe.src = url.toString();
      }

      // lắng nghe message từ iframe viewer
      window.addEventListener('message', (ev) => {
        // chỉ nhận message từ cùng origin
        if(ev.origin !== window.location.origin) return;
        const m = ev.data;
        if(m === 'viewer:decrypted' || m === 'viewer:modelReady' || m === 'viewer:loaded'){
          // viewer báo đã giải mã xong / sẵn sàng -> ẩn loader
          hideLoader();
        }
      }, false);

      document.querySelectorAll('.thumbnail-3d').forEach(btn => {
        btn.addEventListener('click', () => {
          const model = btn.getAttribute('data-model'); // ví dụ 'Dau_du.glb'
          if (model) setModelInIframe(model);

          document.getElementById('model-name').textContent     = btn.getAttribute('data-title')    || '';
          document.getElementById('model-material').textContent = btn.getAttribute('data-material') || '';
          document.getElementById('model-origin').textContent   = btn.getAttribute('data-origin')   || '';
          //document.getElementById('model-desc').textContent     = btn.getAttribute('data-desc')     || '';

          document.querySelectorAll('.thumbnail-3d')
                  .forEach(b=>b.classList.remove('border-orange-400','border-2'));
          btn.classList.add('border-orange-400','border-2');
        });
      });

      // nếu iframe đã load lần đầu (khi mở trang), hiển thị loader cho lần load initial
      // và chờ message từ iframe để ẩn
      showLoader();

      // cuối cùng: ẩn loader khi trang unload
      window.addEventListener('beforeunload', ()=> hideLoader());
    })();
  </script>

  <script src="../main.js"></script>
</body>
</html>